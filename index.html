<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>XENDRA AI</title>
  <link rel="icon" type="image/png" href="fav.png" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  font-family:Arial;
  background:#0f172a;
  color:white;
}
#login-screen, #app {
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
}
input {
  padding:10px;
  margin:10px;
  border-radius:6px;
  border:none;
}
button {
  padding:10px 20px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2563eb;
  color:white;
}
#chat {
  flex:1;
  width:100%;
  overflow-y:auto;
  padding:20px;
}
.message {
  margin-bottom:20px;
}
.user { text-align:right; }
.ai { text-align:left; }
</style>
</head>

<body>

<div id="login-screen">
  <h2>Login XENDRA AI</h2>
  <input type="password" id="password" placeholder="Masukkan Password">
  <button onclick="login()">Login</button>
</div>

<div id="app" style="display:none; flex-direction:column;">
  <div id="chat"></div>
  <div style="display:flex; padding:10px;">
    <input id="prompt" style="flex:1;">
    <button onclick="send()">Kirim</button>
  </div>
</div>

<script>
const API = "https://xendra-ai.vincent-ssb88.workers.dev";
let token = localStorage.getItem("x_token");
let messages = [];

if (token) showApp();

async function login(){
  const password = document.getElementById("password").value;

  const res = await fetch(API+"/login",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ password })
  });

  const data = await res.json();

  if(data.error){
    alert(data.error);
    return;
  }

  localStorage.setItem("x_token", data.token);
  token = data.token;
  showApp();
}

function showApp(){
  document.getElementById("login-screen").style.display="none";
  document.getElementById("app").style.display="flex";
}

async function send(){
  const text = document.getElementById("prompt").value;
  if(!text) return;

  addMessage(text,"user");
  document.getElementById("prompt").value="";

  messages.push({ role:"user", content:text });

  const res = await fetch(API+"/chat",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+token
    },
    body:JSON.stringify({ messages })
  });

  const data = await res.json();

  if(data.error){
    alert(data.error);
    return;
  }

  let full="";
  data.parts.forEach(p=>full+=p);

  messages.push({ role:"assistant", content:full });

  addMessage(full,"ai");
}

function addMessage(text,role){
  const div=document.createElement("div");
  div.className="message "+role;
  div.innerText=text;
  document.getElementById("chat").appendChild(div);
}
</script>

</body>
</html>
