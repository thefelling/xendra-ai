<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="fav.png" />
<title>XENDRA AI</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}

body {
  background: #0f172a;
  color: white;
  display: flex;
  flex-direction: column;
  height: 100vh;
}

header {
  padding: 20px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  background: #111827;
}

#chat-container {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.message {
  margin-bottom: 20px;
  max-width: 800px;
}

.user {
  text-align: right;
}

.user .bubble {
  background: #2563eb;
}

.ai .bubble {
  background: #1e293b;
}

.bubble {
  display: inline-block;
  padding: 15px;
  border-radius: 12px;
  white-space: pre-wrap;
}

input-container {
  display: flex;
}

#input-area {
  display: flex;
  padding: 15px;
  background: #111827;
}

#prompt {
  flex: 1;
  padding: 12px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}

button {
  margin-left: 10px;
  padding: 12px 20px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  background: #2563eb;
  color: white;
  font-weight: bold;
}

img {
  max-width: 100%;
  border-radius: 10px;
  margin-top: 10px;
}

pre {
  background: #0f172a;
  padding: 10px;
  overflow-x: auto;
  border-radius: 8px;
}
</style>
</head>

<body>

<header>XENDRA AI ðŸš€</header>

<div id="chat-container"></div>

<div id="input-area">
  <input type="text" id="prompt" placeholder="Tanyakan sesuatu..." />
  <button onclick="sendMessage()">Kirim</button>
</div>

<script>

const API_URL = "https://xendra-ai.vincent-ssb88.workers.dev";

let messages = [];

async function sendMessage() {
  const input = document.getElementById("prompt");
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "user");
  input.value = "";

  if (isImageRequest(text)) {
    await generateImage(text);
  } else {
    await chat(text);
  }
}

function addMessage(content, role, isHTML = false) {
  const container = document.getElementById("chat-container");
  const div = document.createElement("div");
  div.className = `message ${role}`;

  const bubble = document.createElement("div");
  bubble.className = "bubble";

  if (isHTML) {
    bubble.innerHTML = content;
  } else {
    bubble.textContent = content;
  }

  div.appendChild(bubble);
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
}

function isImageRequest(text) {
  return text.match(/gambar|image|foto|ilustrasi|buat gambar/i);
}

async function chat(text) {

  messages.push({ role: "user", content: text });

  const response = await fetch(`${API_URL}/chat`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ messages })
  });

  const data = await response.json();

  if (data.error) {
    addMessage(data.error, "ai");
    return;
  }

  let fullResponse = "";

  data.parts.forEach(part => {
    fullResponse += part;
  });

  messages.push({ role: "assistant", content: fullResponse });

  addMessage(formatResponse(fullResponse), "ai", true);
}

async function generateImage(prompt) {

  const response = await fetch(`${API_URL}/generate-image`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ prompt })
  });

  const data = await response.json();

  if (data.error) {
    addMessage(data.error, "ai");
    return;
  }

  const imageHTML = `
    <div>
      <img src="${data.image}" />
      <br/>
      <a href="${data.image}" download="xendra.png">
        <button>Download Gambar</button>
      </a>
    </div>
  `;

  addMessage(imageHTML, "ai", true);
}

function formatResponse(text) {
  text = text.replace(/```([\s\S]*?)```/g, "<pre>$1</pre>");
  text = text.replace(/\n/g, "<br>");
  return text;
}

</script>

</body>
</html>
