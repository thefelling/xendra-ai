<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>XENDRA AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  font-family: Inter, sans-serif;
  background: linear-gradient(135deg,#0f172a,#020617);
  color:white;
  display:flex;
  flex-direction:column;
  height:100vh;
}

#login-screen, #app {
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
}

.card {
  background:#111827;
  padding:40px;
  border-radius:20px;
  box-shadow:0 0 40px rgba(0,0,0,0.5);
}

input, textarea {
  padding:12px;
  margin:10px 0;
  border-radius:10px;
  border:none;
  outline:none;
  width:300px;
}

button {
  padding:12px 20px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  background:#2563eb;
  color:white;
  font-weight:bold;
  transition:0.3s;
}

button:hover {
  background:#1d4ed8;
}

#chat {
  flex:1;
  width:100%;
  overflow-y:auto;
  padding:30px;
}

.message {
  max-width:800px;
  margin-bottom:20px;
  padding:15px 20px;
  border-radius:15px;
  animation:fade 0.3s ease;
  white-space:pre-wrap;
}

.user {
  background:#2563eb;
  margin-left:auto;
}

.ai {
  background:#1e293b;
  margin-right:auto;
}

#input-area {
  display:flex;
  padding:20px;
  background:#0f172a;
}

#prompt {
  flex:1;
  border-radius:15px;
  padding:15px;
  border:none;
  outline:none;
}

@keyframes fade {
  from { opacity:0; transform:translateY(10px); }
  to { opacity:1; transform:translateY(0); }
}
</style>
</head>

<body>

<div id="login-screen">
  <div class="card">
    <h2>ðŸš€ XENDRA AI</h2>
    <input type="password" id="password" placeholder="Masukkan Password">
    <button onclick="login()">Login</button>
  </div>
</div>

<div id="app" style="display:none; flex-direction:column;">
  <div id="chat"></div>
  <div id="input-area">
    <textarea id="prompt" rows="1" placeholder="Tanyakan sesuatu..."></textarea>
    <button onclick="send()">Kirim</button>
  </div>
</div>

<script>
const API="https://xendra-ai.vincent-ssb88.workers.dev";
let token=localStorage.getItem("x_token");
let messages=[];

if(token) showApp();

document.getElementById("prompt").addEventListener("keydown",function(e){
  if(e.key==="Enter"&&!e.shiftKey){
    e.preventDefault();
    send();
  }
});

async function login(){
  const password=document.getElementById("password").value;

  const res=await fetch(API+"/login",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ password })
  });

  const data=await res.json();
  if(data.error){ alert(data.error); return; }

  localStorage.setItem("x_token",data.token);
  token=data.token;
  showApp();
}

function showApp(){
  document.getElementById("login-screen").style.display="none";
  document.getElementById("app").style.display="flex";
}

async function send(){
  const input=document.getElementById("prompt");
  const text=input.value.trim();
  if(!text) return;

  addMessage(text,"user");
  input.value="";

  messages.push({ role:"user", content:text });

  const res=await fetch(API+"/chat",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+token
    },
    body:JSON.stringify({ messages })
  });

  const data=await res.json();
  if(data.error){ alert(data.error); return; }

  let full="";
  data.parts.forEach(p=>full+=p);

  messages.push({ role:"assistant", content:full });
  addMessage(full,"ai");
}

function addMessage(text,role){
  const div=document.createElement("div");
  div.className="message "+role;
  div.textContent=text;
  document.getElementById("chat").appendChild(div);
  document.getElementById("chat").scrollTop=999999;
}
</script>

</body>
</html>
